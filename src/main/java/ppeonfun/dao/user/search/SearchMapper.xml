<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ppeonfun.dao.user.search.SearchDao">
	<select id="selectCntAllByKeyword" parameterType="String" resultType="int">
		select count(*) from project
		where p_name like '%' || #{keyword} || '%'
	</select>
	
	<select id="selectSearchList" parameterType="hashmap" resultType="hashmap">
		select * from (
			select rownum rnum, S.* from (	
				select 
				    (select sum(paym_amount) from payment where p_no = p.p_no) funded_money
				    , i.i_money
				    , (select round( ( (select sum(paym_amount) from payment where p_no = p.p_no ) / i.i_money ) * 100, 2 ) || '%' from dual) funded_percent
				    , i.i_stored_name, i.i_category, i.i_end_date, p.*
				from project p, information i
				where p.p_no = i.p_no
				and p.p_name like '%' || #{keyword} || '%'
				order by p.p_no desc
			) S
		) R
		where rnum between #{paging.startNo} and #{paging.endNo}		
	</select>
</mapper>

